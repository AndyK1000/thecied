# HTTP Virtual Host - Redirect to HTTPS
<VirtualHost *:80>
    ServerName thecied.dev
    ServerAlias www.thecied.dev
    
    # Allow Let's Encrypt challenge files
    Alias /.well-known /opt/bitnami/apache/htdocs/.well-known
    <Directory /opt/bitnami/apache/htdocs/.well-known>
        Require all granted
    </Directory>
    
    # Redirect all other requests to HTTPS
    RewriteEngine On
    RewriteCond %{REQUEST_URI} !^/.well-known/
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

# HTTPS Virtual Host
<VirtualHost *:443>
    ServerName thecied.dev
    ServerAlias www.thecied.dev
    DocumentRoot /home/bitnami/thecied
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/thecied.dev/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/thecied.dev/privkey.pem
    
    # WSGI Configuration - Updated for Django
    WSGIDaemonProcess thecied_ssl python-home=/opt/bitnami/python python-path=/home/bitnami/thecied:/opt/bitnami/python/lib/python3.12/site-packages:/home/bitnami/.local/lib/python3.12/site-packages display-name=%{GROUP} processes=2 threads=15
    WSGIProcessGroup thecied_ssl
    WSGIScriptAlias / /home/bitnami/thecied/thecied/wsgi.py
    WSGIApplicationGroup %{GLOBAL}
    
    # WSGI Script permissions
    <Directory /home/bitnami/thecied/thecied>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>
    
    # Static files
    Alias /static /home/bitnami/thecied/staticfiles
    <Directory /home/bitnami/thecied/staticfiles>
        Require all granted
    </Directory>
    
    # Logging
    ErrorLog /opt/bitnami/apache2/logs/thecied_ssl_error.log
    CustomLog /opt/bitnami/apache2/logs/thecied_ssl_access.log combined
</VirtualHost>
